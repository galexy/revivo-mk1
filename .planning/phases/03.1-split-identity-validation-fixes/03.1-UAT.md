---
status: complete
phase: 03.1-split-identity-validation-fixes
source: [03.1-01-SUMMARY.md, 03.1-02-SUMMARY.md, 03.1-03-SUMMARY.md, 03.1-04-SUMMARY.md]
started: 2026-02-02T22:00:00Z
updated: 2026-02-02T23:30:00Z
---

## Setup

Set these variables before running tests:

```bash
# Get an account ID (create one or list existing)
ACCOUNT_ID="acct_01jk..."

# Get a second account for transfers
ACCOUNT_ID_2="acct_01jk..."

# Get or create a category
CATEGORY_ID="cat_01jk..."

# Base URL
API="http://localhost:8000/api/v1"
```

## Current Test

[testing complete]

## Tests

### 1. Split IDs in Transaction Response
expected: POST a new transaction. Response should include a `splits` array where each split has an `id` field starting with "split_".
result: pass

### 2. Split IDs Persist Across GET
expected: Create a transaction, note the split ID. GET the same transaction. The split ID should be the same value.
result: pass

### 3. PATCH Preserves Split IDs
expected: Create a transaction with splits, note the split IDs. PATCH the transaction including the splits with their IDs. The response should show the same split IDs (not new ones).
result: pass

### 4. Transfer Creates Mirror with source_split_id
expected: Create a transfer transaction (split with transfer_account_id). The mirror transaction in the target account should have a `source_split_id` field linking back to the original split.
result: pass

### 5. Invalid Account ID Returns 400
expected: POST a transaction with an invalid account_id format (e.g., "invalid"). Should return HTTP 400 (not 500) with error code INVALID_ID_FORMAT or VALIDATION_ERROR.
result: pass

### 6. Invalid Category ID Returns 400
expected: POST a transaction with a split containing an invalid category_id format (e.g., "bad_id"). Should return HTTP 400 (not 500).
result: pass

### 7. Empty String Category ID Returns 422
expected: POST a transaction with a split where category_id is an empty string "". Should return HTTP 422 (Pydantic validation error), not silently accept it as null.
result: pass

### 8. Create Category with Default Type
expected: POST a new category without specifying category_type. Response should include `category_type: "expense"` (the default).
result: pass

### 9. Create Income Category
expected: POST a new category with `category_type: "income"`. Response should include `category_type: "income"`.
result: pass

### 10. Invalid Category Type Returns 422
expected: POST a new category with `category_type: "invalid"`. Should return HTTP 422 (Pydantic validation error).
result: pass

## Summary

total: 10
passed: 10
issues: 0
pending: 0
skipped: 0

## Gaps

[none]
