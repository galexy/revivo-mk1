---
phase: 15-api-integration-validation
plan: 03
type: execute
wave: 2
depends_on: ["15-01"]
files_modified:
  - apps/web/src/features/accounts/validation/accountSchemas.ts
  - apps/web/src/features/accounts/components/ProgressDots.tsx
  - apps/web/src/features/accounts/components/AccountWizardSteps/StepTypeSelection.tsx
  - apps/web/src/features/accounts/components/AccountWizardSteps/StepDetails.tsx
  - apps/web/src/features/accounts/components/AccountWizardSteps/StepOpeningBalance.tsx
  - apps/web/src/features/accounts/components/AccountWizardSteps/StepReview.tsx
  - apps/web/src/features/accounts/components/AccountWizard.tsx
  - apps/web/src/features/accounts/components/DeleteAccountDialog.tsx
autonomous: true

must_haves:
  truths:
    - "Wizard modal has 4 steps with progress dots"
    - "Step 1 shows all 7 account types as radio selection"
    - "Step 2 shows name + type-specific fields (credit_limit for credit cards, apr/term for loans, subtype for IRA)"
    - "Step 3 shows currency input for opening balance"
    - "Step 4 shows read-only review of all entered data"
    - "Delete dialog requires typing account name to confirm"
  artifacts:
    - path: "apps/web/src/features/accounts/validation/accountSchemas.ts"
      provides: "Per-step Zod validation schemas"
      min_lines: 30
    - path: "apps/web/src/features/accounts/components/AccountWizard.tsx"
      provides: "4-step wizard dialog container"
      min_lines: 40
    - path: "apps/web/src/features/accounts/components/DeleteAccountDialog.tsx"
      provides: "Type-to-confirm delete dialog"
      min_lines: 30
    - path: "apps/web/src/features/accounts/components/ProgressDots.tsx"
      provides: "Progress dot indicator"
  key_links:
    - from: "apps/web/src/features/accounts/components/AccountWizard.tsx"
      to: "apps/web/src/features/accounts/validation/accountSchemas.ts"
      via: "zodResolver import"
      pattern: "zodResolver"
---

<objective>
Design the account wizard modal (4-step) and delete confirmation dialog, using the frontend-design skill for visual quality.

Purpose: Visual-first design of the wizard and delete flows before wiring mutations.
Output: Polished wizard with all 4 steps rendered statically, plus type-to-confirm delete dialog.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/CHECKPOINTS.md
@.planning/phases/15-api-integration-validation/15-CONTEXT.md
@.planning/phases/15-api-integration-validation/15-RESEARCH.md
@apps/web/src/lib/api-client.ts
@libs/ui/src/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Zod validation schemas and progress dots component</name>
  <files>
    apps/web/src/features/accounts/validation/accountSchemas.ts
    apps/web/src/features/accounts/components/ProgressDots.tsx
  </files>
  <action>
    1. Create `apps/web/src/features/accounts/validation/accountSchemas.ts`:
       Define per-step Zod schemas for progressive validation:

       - `stepTypeSchema`: z.object({ accountType: z.enum(['checking', 'savings', 'credit_card', 'loan', 'brokerage', 'ira', 'rewards']) })

       - `stepDetailsSchema`: z.object({
           name: z.string().min(1, 'Account name is required').max(100, 'Name too long'),
           creditLimit: z.string().optional(),  // Only for credit_card
           apr: z.string().optional(),           // Only for loan
           termMonths: z.string().optional(),    // Only for loan
           subtype: z.enum(['traditional_ira', 'roth_ira', 'sep_ira', 'mortgage', 'auto_loan', 'personal_loan', 'line_of_credit']).optional(),  // For IRA and loan
           rewardsUnit: z.string().optional(),   // Only for rewards (e.g., "Alaska Miles")
         })

       - `stepBalanceSchema`: z.object({
           openingBalance: z.string().min(1, 'Opening balance is required').refine(val => !isNaN(parseFloat(val.replace(/[,$]/g, ''))), { message: 'Invalid amount' }),
           rewardsValue: z.string().optional(),  // For rewards accounts (points/miles count)
         })

       - `stepReviewSchema`: z.object({}) // No validation needed for read-only review

       - Export a `AccountFormData` type that represents the merged form data across all steps
       - Export a `stepSchemas` array for index-based access

    2. Create `apps/web/src/features/accounts/components/ProgressDots.tsx`:
       - Props: currentStep: number, totalSteps: number
       - Render a row of dots using flex layout with gap-2
       - Current step dot: bg-primary (filled)
       - Completed steps: bg-primary/50 (semi-transparent)
       - Future steps: bg-muted (empty)
       - Each dot: h-2 w-2 rounded-full with transition-colors
       - Include aria role="progressbar" with aria-valuenow, aria-valuemin, aria-valuemax
       - Each dot has aria-label describing its state ("Step 1 (current)", "Step 2 (completed)", etc.)

    Verify: `npx nx typecheck web`
  </action>
  <verify>`npx nx typecheck web` passes.</verify>
  <done>
    Zod schemas validate each wizard step independently.
    ProgressDots component renders accessible step indicators.
  </done>
</task>

<task type="auto">
  <name>Task 2: Design wizard step components, wizard container, and delete dialog</name>
  <files>
    apps/web/src/features/accounts/components/AccountWizardSteps/StepTypeSelection.tsx
    apps/web/src/features/accounts/components/AccountWizardSteps/StepDetails.tsx
    apps/web/src/features/accounts/components/AccountWizardSteps/StepOpeningBalance.tsx
    apps/web/src/features/accounts/components/AccountWizardSteps/StepReview.tsx
    apps/web/src/features/accounts/components/AccountWizard.tsx
    apps/web/src/features/accounts/components/DeleteAccountDialog.tsx
  </files>
  <action>
    Use the `frontend-design` skill for high-quality visual output. Research shadcn/ui Dialog and RadioGroup patterns before implementing.

    1. Create `StepTypeSelection.tsx` (Step 1):
       - RadioGroup with all 7 account types displayed as cards/tiles
       - Each type shows: name, brief description, and an icon/emoji
       - Layout: 2-column grid on desktop, 1-column on mobile
       - Types and descriptions:
         - Checking: "Everyday spending" (icon: wallet/banknote)
         - Savings: "Savings goals" (icon: piggy bank)
         - Credit Card: "Credit card tracking" (icon: credit card)
         - Loan: "Mortgages, auto, personal" (icon: landmark/building)
         - Brokerage: "Investment accounts" (icon: chart/trending)
         - IRA: "Retirement accounts" (icon: shield/lock)
         - Rewards: "Points and miles" (icon: star/gift)
       - Uses shadcn RadioGroup + RadioGroupItem with custom card-style rendering
       - Props: form (UseFormReturn), onNext callback

    2. Create `StepDetails.tsx` (Step 2):
       - Account name input (required, always shown)
       - Conditional fields based on accountType (from form context or prop):
         - credit_card: Credit Limit input (currency formatted)
         - loan: APR input (percentage), Term (months), Loan Subtype select (mortgage, auto, personal, line_of_credit)
         - ira: IRA Subtype select (traditional, roth, sep)
         - rewards: Reward Unit name input (e.g., "Alaska Miles", "Chase Points")
         - checking/savings/brokerage: No extra fields
       - Uses shadcn Input, Select components
       - Props: form (UseFormReturn), accountType (string), onNext/onBack callbacks

    3. Create `StepOpeningBalance.tsx` (Step 3):
       - For monetary accounts (not rewards): react-currency-input-field with USD prefix
       - For rewards accounts: plain number input for points/miles value
       - Brief helper text: "Enter the current balance of your account"
       - Props: form (UseFormReturn), accountType (string), onNext/onBack callbacks

    4. Create `StepReview.tsx` (Step 4):
       - Read-only display of all entered data
       - Organized as a summary card with labeled rows:
         - Account Type: [human-readable name]
         - Name: [entered name]
         - Opening Balance: [formatted amount]
         - Type-specific fields if applicable
       - "Create Account" button (primary, prominent) and "Back" button
       - Props: formData (all accumulated form values), onSubmit/onBack callbacks, isSubmitting (boolean)

    5. Create `AccountWizard.tsx`:
       - Controlled Dialog with open/onOpenChange props
       - DialogContent with max-w-lg for focused wizard feel
       - ProgressDots at top showing current step
       - DialogTitle changes per step: "Choose Account Type" -> "Account Details" -> "Opening Balance" -> "Review"
       - Renders current step component based on currentStep state
       - Back/Next navigation (Back on all steps except first, Next on all except last)
       - CRITICAL: useEffect that resets form and step to 0 when dialog closes (prevents stale state on reopen)
       - Multi-step form state managed with useState for accumulated formData and useForm per step
       - Edit mode: accepts optional `editAccount` prop (AccountResponse). When provided:
         - Pre-fill form data from existing account
         - Lock account type (show as read-only text in Step 1, skip to Step 2)
         - Change title to "Edit Account"
         - Change submit button to "Save Changes"
       - Props: open, onOpenChange, editAccount? (AccountResponse), onSubmit (formData) => void

    6. Create `DeleteAccountDialog.tsx`:
       - Controlled Dialog with open/onOpenChange
       - Shows account name prominently
       - Warning text: "This action cannot be undone. Type [account name] to confirm."
       - Input field for typing account name
       - Delete button (variant="destructive") disabled until input matches account name exactly
       - Cancel button (variant="outline")
       - Input and confirmText state reset when dialog closes (useEffect watching open prop)
       - Props: open, onOpenChange, accountName (string), accountId (string), onConfirmDelete (id: string) => void

    All components use shadcn/ui primitives. No API calls -- just design and form state management.

    Verify: `npx nx typecheck web`
  </action>
  <verify>`npx nx typecheck web` passes.</verify>
  <done>
    AccountWizard renders all 4 steps with proper navigation, validation, edit mode, and form reset.
    DeleteAccountDialog renders type-to-confirm pattern with proper state management.
    All step components visually polished and correctly use shadcn/ui primitives.
  </done>
</task>

</tasks>

<verification>
- `npx nx typecheck web` passes
- Wizard modal opens with 4 steps and progress dots
- Each step renders correct fields for each account type
- Edit mode pre-fills existing account data and locks account type
- Delete dialog requires exact name match to enable delete button
</verification>

<success_criteria>
Visual design of wizard and delete dialog complete. Components handle form state and navigation without API calls.
</success_criteria>

<output>
After completion, create `.planning/phases/15-api-integration-validation/15-03-SUMMARY.md`
</output>
