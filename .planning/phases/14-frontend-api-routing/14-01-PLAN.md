---
phase: 14-frontend-api-routing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/package.json
  - apps/web/project.json
  - apps/web/src/lib/api-types.generated.ts
  - apps/api/scripts/generate_openapi.py
autonomous: true

must_haves:
  truths:
    - "OpenAPI TypeScript types are auto-generated from backend /openapi.json"
    - "TanStack Query and devtools packages are installed"
    - "openapi-typescript dev dependency is installed"
    - "Nx target exists to regenerate types from OpenAPI spec"
  artifacts:
    - path: "apps/web/src/lib/api-types.generated.ts"
      provides: "Generated TypeScript types from OpenAPI spec"
      contains: "paths"
    - path: "apps/api/scripts/generate_openapi.py"
      provides: "Python script to extract OpenAPI JSON from FastAPI app"
      contains: "create_app"
  key_links:
    - from: "apps/api/scripts/generate_openapi.py"
      to: "apps/api/src/adapters/api/app.py"
      via: "import create_app and call app.openapi()"
      pattern: "create_app"
---

<objective>
Install TanStack Query and openapi-typescript, generate TypeScript types from the backend's OpenAPI spec.

Purpose: Establish the type generation pipeline so all API types stay in sync with the backend automatically. TanStack Query is installed and ready for use in subsequent plans.

Output: Generated TypeScript types file, npm packages installed, Nx generate target.
</objective>

<execution_context>
@/home/developer/.claude/get-shit-done/workflows/execute-plan.md
@/home/developer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@apps/web/package.json
@apps/web/project.json
@apps/api/src/adapters/api/app.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install packages and create OpenAPI generation script</name>
  <files>
    apps/web/package.json
    apps/api/scripts/generate_openapi.py
  </files>
  <action>
    1. Install npm packages in apps/web/:
       ```
       pnpm add @tanstack/react-query @tanstack/react-query-devtools
       pnpm add -D openapi-typescript
       ```

    2. Create `apps/api/scripts/generate_openapi.py` - a Python script that:
       - Imports `create_app` from `src.adapters.api.app`
       - Calls `app.openapi()` to get the OpenAPI schema dict
       - Writes it as JSON to stdout (so it can be piped)
       - Does NOT start the server or initialize the database
       - Usage: `uv run --package personal-finance-api python apps/api/scripts/generate_openapi.py > openapi.json`

    3. Verify the script produces valid JSON by running it.
  </action>
  <verify>
    - `pnpm ls @tanstack/react-query @tanstack/react-query-devtools openapi-typescript` shows all three packages
    - `uv run --package personal-finance-api python apps/api/scripts/generate_openapi.py | python -m json.tool > /dev/null` succeeds
  </verify>
  <done>
    TanStack Query packages installed. OpenAPI generation script produces valid JSON from FastAPI app without needing a running server.
  </done>
</task>

<task type="auto">
  <name>Task 2: Generate TypeScript types and add Nx target</name>
  <files>
    apps/web/src/lib/api-types.generated.ts
    apps/web/project.json
  </files>
  <action>
    1. Run the generation pipeline:
       ```
       uv run --package personal-finance-api python apps/api/scripts/generate_openapi.py > /tmp/openapi.json
       cd apps/web && npx openapi-typescript /tmp/openapi.json -o src/lib/api-types.generated.ts
       ```

    2. Verify the generated file contains TypeScript interfaces for:
       - `paths` (API endpoints like `/api/v1/accounts`, `/auth/token`, etc.)
       - `components.schemas` (response/request types like AccountResponse, TokenResponse, etc.)

    3. Add an Nx target `generate-api-types` in `apps/web/project.json`:
       ```json
       "generate-api-types": {
         "executor": "nx:run-commands",
         "options": {
           "commands": [
             "uv run --package personal-finance-api python apps/api/scripts/generate_openapi.py > /tmp/openapi.json",
             "npx openapi-typescript /tmp/openapi.json -o apps/web/src/lib/api-types.generated.ts"
           ],
           "cwd": "{workspaceRoot}",
           "parallel": false
         }
       }
       ```

    4. Verify the Nx target works: `npx nx generate-api-types web`

    5. Run `npx nx typecheck web` to verify the generated types compile without errors.
  </action>
  <verify>
    - `apps/web/src/lib/api-types.generated.ts` exists and is non-empty
    - The file contains `paths` type with API routes
    - The file contains `components` type with schema types
    - `npx nx generate-api-types web` succeeds
    - `npx nx typecheck web` passes
  </verify>
  <done>
    TypeScript types generated from OpenAPI spec. Nx target available for regeneration. Types compile without errors.
  </done>
</task>

</tasks>

<verification>
1. `pnpm ls @tanstack/react-query` shows package installed
2. `apps/web/src/lib/api-types.generated.ts` contains generated types
3. `npx nx generate-api-types web` runs successfully
4. `npx nx typecheck web` passes
5. `npx nx test web` passes (existing tests still work)
</verification>

<success_criteria>
- OpenAPI TypeScript types generated from backend spec
- TanStack Query packages installed
- Nx target for type regeneration works
- All existing tests and type checks pass
</success_criteria>

<output>
After completion, create `.planning/phases/14-frontend-api-routing/14-01-SUMMARY.md`
</output>
