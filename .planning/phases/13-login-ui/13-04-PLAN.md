---
phase: 13-login-ui
plan: 04
type: execute
wave: 3
depends_on: ["13-03"]
files_modified:
  - apps/web/src/features/auth/validation.ts
  - apps/web/src/features/auth/components/PasswordInput.tsx
  - apps/web/src/features/auth/components/LoginForm.tsx
  - apps/web/src/features/auth/components/RegisterForm.tsx
  - apps/web/src/pages/LoginPage.tsx
  - apps/web/src/pages/RegisterPage.tsx
  - apps/web/src/app/App.tsx
autonomous: true

must_haves:
  truths:
    - "Login form has email, password, remember me checkbox, and submit button"
    - "Login form password field has show/hide eye icon toggle"
    - "Login form shows validation errors inline below fields"
    - "Login form displays server error (invalid credentials) on failure"
    - "Successful login redirects to /dashboard"
    - "Registration form has email, password, display name fields"
    - "After registration shows verification notice — does NOT auto-login"
    - "Link between login and register pages works both ways"
  artifacts:
    - path: "apps/web/src/features/auth/validation.ts"
      provides: "Zod schemas for login and registration forms"
      contains: "loginSchema"
    - path: "apps/web/src/features/auth/components/PasswordInput.tsx"
      provides: "Password input with eye toggle"
      contains: "EyeOpenIcon"
    - path: "apps/web/src/features/auth/components/LoginForm.tsx"
      provides: "Login form with react-hook-form + shadcn/ui"
      contains: "LoginForm"
    - path: "apps/web/src/features/auth/components/RegisterForm.tsx"
      provides: "Registration form with verification notice"
      contains: "RegisterForm"
    - path: "apps/web/src/pages/LoginPage.tsx"
      provides: "Centered card login page layout"
      contains: "LoginPage"
    - path: "apps/web/src/pages/RegisterPage.tsx"
      provides: "Centered card registration page layout"
      contains: "RegisterPage"
  key_links:
    - from: "apps/web/src/features/auth/components/LoginForm.tsx"
      to: "apps/web/src/features/auth/context/useAuth.ts"
      via: "useAuth().login()"
      pattern: "useAuth.*login"
    - from: "apps/web/src/features/auth/components/RegisterForm.tsx"
      to: "apps/web/src/lib/api.ts"
      via: "api.post('/auth/register')"
      pattern: "/auth/register"
    - from: "apps/web/src/pages/LoginPage.tsx"
      to: "/register"
      via: "Link component"
      pattern: "to=\"/register\""
---

<objective>
Build the login and registration pages with form validation, password toggle, and proper error handling.

Purpose: These are the primary user-facing auth pages. Login authenticates existing users (email/password + remember me). Registration creates new accounts and shows a verification notice. Both pages follow the centered card layout (Linear/Vercel style) per user decision.

Output: Working login and registration pages with Zod validation, shadcn/ui Form components, and proper auth flow integration.
</objective>

<execution_context>
@/home/developer/.claude/get-shit-done/workflows/execute-plan.md
@/home/developer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@apps/web/src/features/auth/context/AuthContext.tsx
@apps/web/src/features/auth/context/useAuth.ts
@apps/web/src/features/auth/types.ts
@apps/web/src/lib/api.ts
@apps/web/src/app/App.tsx
@libs/ui/src/index.ts
@.planning/phases/13-login-ui/13-CONTEXT.md
@.planning/phases/13-login-ui/13-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Zod validation schemas and PasswordInput component</name>
  <files>
    apps/web/src/features/auth/validation.ts
    apps/web/src/features/auth/components/PasswordInput.tsx
  </files>
  <action>
**Create `apps/web/src/features/auth/validation.ts`:**

Zod schemas for login and registration forms. Match backend password validation rules (min 8 chars, uppercase, lowercase, number, symbol).

```typescript
import { z } from 'zod';

export const loginSchema = z.object({
  email: z.string().email('Please enter a valid email address'),
  password: z.string().min(1, 'Password is required'),
  rememberMe: z.boolean().default(false),
});

export type LoginFormData = z.infer<typeof loginSchema>;

export const registerSchema = z.object({
  email: z.string().email('Please enter a valid email address'),
  password: z
    .string()
    .min(8, 'Password must be at least 8 characters')
    .regex(/[A-Z]/, 'Must contain an uppercase letter')
    .regex(/[a-z]/, 'Must contain a lowercase letter')
    .regex(/[0-9]/, 'Must contain a number')
    .regex(/[^A-Za-z0-9]/, 'Must contain a symbol'),
  displayName: z.string().min(1, 'Display name is required').trim(),
});

export type RegisterFormData = z.infer<typeof registerSchema>;
```

Note: Login schema only validates non-empty password (server handles actual validation). Registration schema mirrors backend rules for immediate feedback.

**Create `apps/web/src/features/auth/components/PasswordInput.tsx`:**

Password input with show/hide eye icon toggle using @radix-ui/react-icons.

```typescript
import { useState, forwardRef } from 'react';
import { EyeOpenIcon, EyeClosedIcon } from '@radix-ui/react-icons';
import { Input, Button } from '@workspace/ui';

// Use forwardRef so react-hook-form's register can attach a ref
export const PasswordInput = forwardRef<
  HTMLInputElement,
  React.ComponentProps<typeof Input>
>(function PasswordInput(props, ref) {
  const [showPassword, setShowPassword] = useState(false);

  return (
    <div className="relative">
      <Input
        type={showPassword ? 'text' : 'password'}
        ref={ref}
        {...props}
        className="pr-10"
      />
      <Button
        type="button"
        variant="ghost"
        size="icon-xs"
        className="absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground"
        onClick={() => setShowPassword(!showPassword)}
        tabIndex={-1}
        aria-label={showPassword ? 'Hide password' : 'Show password'}
      >
        {showPassword ? (
          <EyeClosedIcon className="size-4" />
        ) : (
          <EyeOpenIcon className="size-4" />
        )}
      </Button>
    </div>
  );
});
```

Key: Uses `forwardRef` so react-hook-form's `register()` can attach its ref. Uses `tabIndex={-1}` on toggle button so tab order stays on the input. `aria-label` for accessibility.
  </action>
  <verify>
    `npx nx typecheck web` passes.
  </verify>
  <done>
    Zod schemas match backend validation. PasswordInput uses forwardRef, renders eye icon toggle, and is accessible (aria-label, tabIndex).
  </done>
</task>

<task type="auto">
  <name>Task 2: Create LoginForm, RegisterForm, and their page wrappers</name>
  <files>
    apps/web/src/features/auth/components/LoginForm.tsx
    apps/web/src/features/auth/components/RegisterForm.tsx
    apps/web/src/pages/LoginPage.tsx
    apps/web/src/pages/RegisterPage.tsx
    apps/web/src/app/App.tsx
  </files>
  <action>
**Create `apps/web/src/features/auth/components/LoginForm.tsx`:**

Login form using react-hook-form + Zod + shadcn/ui Form components.

Implementation requirements from CONTEXT.md (locked decisions):
- Email field, password field with eye toggle, "Remember me" checkbox
- No "Forgot password?" link
- Server error displayed below the form (use `form.setError('root', ...)`)
- Loading state on submit button ("Logging in..." text + disabled)
- On success: useAuth().login() handles redirect (it will navigate to /dashboard via React Router navigate or window.location)

Wait — the login() function in AuthContext returns void on success but throws on failure. The LoginForm should:
1. Call `await login(email, password, rememberMe)`
2. On success: navigate to '/dashboard' via `useNavigate()` from `@tanstack/react-router`
3. On failure: catch error, extract message, show as root error

Use shadcn/ui Form component (wraps react-hook-form FormProvider) with FormField, FormItem, FormLabel, FormControl, FormMessage for each field. Use the Checkbox component from @workspace/ui for "Remember me".

Link to register: `<Link to="/register">Don't have an account? Sign up</Link>` below the form. Use `Link` from `@tanstack/react-router` for type-safe navigation.

**Create `apps/web/src/features/auth/components/RegisterForm.tsx`:**

Registration form with email, password, display name fields.

Implementation:
1. Uses registerSchema from validation.ts
2. On submit: calls `api.post('/auth/register', { email, password, display_name: displayName })`
3. On success: show verification notice state — replace form with success message: "Check your email to verify your account" with a link to /login ("Back to login")
4. On failure: if 422 (validation), show field-level errors. If other error, show root error.
5. Do NOT use useAuth().login() — registration does NOT auto-login per user decision

Use `useState<boolean>(false)` for `isRegistered` state. When true, render the success message instead of the form.

Link to login: `<Link to="/login">Already have an account? Log in</Link>` below the form. Use `Link` from `@tanstack/react-router`.

**Create `apps/web/src/pages/LoginPage.tsx`:**

Centered card layout (Linear/Vercel style):
```
- Full page, centered both horizontally and vertically
- Logo/app name above the card (text "Personal Finance" with an icon or just bold text)
- Card component wrapping the LoginForm
- Background: bg-background
- Card: max-w-md
```

If user is already authenticated, redirect to /dashboard (use `useAuth` + `useNavigate` from `@tanstack/react-router` in a useEffect, or handle via `beforeLoad` on the login route in routes.tsx).

**Create `apps/web/src/pages/RegisterPage.tsx`:**

Same centered layout as LoginPage but with RegisterForm. Same authenticated redirect.

**Update `apps/web/src/routes.tsx`:**

Replace the placeholder LoginPage and RegisterPage components in the route definitions with imports from the actual page files:
```typescript
import { LoginPage } from './pages/LoginPage';
import { RegisterPage } from './pages/RegisterPage';
```
Update the loginRoute and registerRoute to use these real components. Keep the other placeholders (VerifyEmailPage, DashboardPage) for now.

Design decisions (Claude's discretion):
- Error display: Use inline errors below each field via FormMessage (shadcn/ui pattern). Server errors (root) displayed as a red banner/alert above the submit button.
- Loading state: Button shows "Logging in..." with disabled state during submission (uses form.formState.isSubmitting)
- Spacing: space-y-4 for form fields, space-y-6 for page sections
  </action>
  <verify>
    `npx nx typecheck web` passes.
    `npx nx test web` passes.
    Start both services (`npx nx serve api` and `npx nx serve web`) and verify:
    - Navigate to http://localhost:5173/login — see login form with email, password (with eye toggle), remember me, submit button
    - Navigate to http://localhost:5173/register — see registration form with email, password, display name
    - Click "Don't have an account? Sign up" on login page navigates to register
    - Click "Already have an account? Log in" on register page navigates to login
    - Submit login with invalid credentials — see error message
  </verify>
  <done>
    Login page: centered card with email/password/rememberMe/submit, eye toggle, server error display, link to register. Registration page: centered card with email/password/displayName, shows verification notice on success, link to login. Both redirect authenticated users to dashboard.
  </done>
</task>

</tasks>

<verification>
- `npx nx typecheck web && npx nx test web` passes
- Login form renders with all required elements
- Registration form renders and shows verification notice on success
- Password eye toggle works
- Validation errors display inline
- Links between login and register pages work
</verification>

<success_criteria>
1. Login form with email, password (eye toggle), remember me checkbox, submit button
2. Login error handling: inline validation + server error display
3. Registration form with email, password, display name
4. Registration success shows "Check your email" notice (no auto-login)
5. Centered card layout on both pages (Linear/Vercel style)
6. Navigation links between login and register
</success_criteria>

<output>
After completion, create `.planning/phases/13-login-ui/13-04-SUMMARY.md`
</output>
