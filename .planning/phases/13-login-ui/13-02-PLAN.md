---
phase: 13-login-ui
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - libs/ui/src/components/form.tsx
  - libs/ui/src/components/checkbox.tsx
  - libs/ui/src/components/dropdown-menu.tsx
  - libs/ui/src/components/avatar.tsx
  - libs/ui/src/index.ts
  - libs/ui/package.json
autonomous: true

must_haves:
  truths:
    - "shadcn/ui Form component works with react-hook-form"
    - "shadcn/ui Checkbox renders and toggles"
    - "shadcn/ui DropdownMenu opens and closes"
    - "shadcn/ui Avatar displays initials fallback"
  artifacts:
    - path: "libs/ui/src/components/form.tsx"
      provides: "Form, FormField, FormItem, FormLabel, FormControl, FormMessage components"
      contains: "FormField"
    - path: "libs/ui/src/components/checkbox.tsx"
      provides: "Checkbox component"
      contains: "Checkbox"
    - path: "libs/ui/src/components/dropdown-menu.tsx"
      provides: "DropdownMenu components"
      contains: "DropdownMenu"
    - path: "libs/ui/src/components/avatar.tsx"
      provides: "Avatar, AvatarFallback components"
      contains: "Avatar"
    - path: "libs/ui/src/index.ts"
      provides: "Re-exports all new components"
      contains: "form"
  key_links:
    - from: "libs/ui/src/components/form.tsx"
      to: "react-hook-form"
      via: "useFormField hook"
      pattern: "react-hook-form"
---

<objective>
Add shadcn/ui Form, Checkbox, DropdownMenu, and Avatar components to the shared UI library.

Purpose: These components are required for login/registration forms (Form + Checkbox), user menu (DropdownMenu + Avatar), and are not yet in libs/ui. Using the shadcn CLI ensures consistency with the existing new-york style.

Output: Four new shadcn/ui components in libs/ui, re-exported from index.ts.
</objective>

<execution_context>
@/home/developer/.claude/get-shit-done/workflows/execute-plan.md
@/home/developer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@libs/ui/package.json
@libs/ui/components.json
@libs/ui/src/index.ts
@.planning/phases/12-frontend-infrastructure/12-06-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add shadcn/ui Form and Checkbox components via CLI</name>
  <files>
    libs/ui/src/components/form.tsx
    libs/ui/src/components/checkbox.tsx
    libs/ui/package.json
    libs/ui/src/index.ts
  </files>
  <action>
Use the shadcn CLI to add Form and Checkbox components to libs/ui. The shadcn CLI needs a pnpm wrapper for PATH resolution (established in Phase 12-06).

**Step 1: Ensure pnpm wrapper exists:**
```bash
mkdir -p /tmp/bin
cat > /tmp/bin/pnpm << 'WRAPPER'
#!/bin/sh
exec npx pnpm "$@"
WRAPPER
chmod +x /tmp/bin/pnpm
```

**Step 2: Add Form component:**
The Form component from shadcn/ui wraps react-hook-form and provides FormField, FormItem, FormLabel, FormControl, FormDescription, FormMessage. This needs react-hook-form and @hookform/resolvers as dependencies.

```bash
cd /workspace/libs/ui && PATH="/tmp/bin:$PATH" pnpm dlx shadcn@latest add form --yes --overwrite
```

The form component requires react-hook-form and zod as peer deps. Since these will be installed in apps/web (Plan 01), and libs/ui is an internal package, the form component should work. However, check if react-hook-form needs to be added to libs/ui peerDependencies.

**Step 3: Add Checkbox component:**
```bash
cd /workspace/libs/ui && PATH="/tmp/bin:$PATH" pnpm dlx shadcn@latest add checkbox --yes --overwrite
```

**Step 4: Update libs/ui/src/index.ts to re-export:**
Add re-exports for all Form-related components:
```typescript
export {
  Form,
  FormControl,
  FormDescription,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
  useFormField,
} from './components/form';
export { Checkbox } from './components/checkbox';
```

**Step 5: Verify dependencies were added to libs/ui/package.json.**
The CLI should add react-hook-form, @hookform/resolvers, and @radix-ui/react-checkbox automatically. If react-hook-form and @hookform/resolvers are not added (because they are in apps/web), add them manually to libs/ui peer dependencies or dependencies.

Run `pnpm install` after all changes to ensure lockfile is updated.

Note: If the CLI-generated form.tsx has import issues (e.g., importing from paths that don't resolve), adjust imports to use `@workspace/ui/lib/utils` for the `cn` utility and ensure Label imports come from the local components.
  </action>
  <verify>
    `npx nx typecheck web` passes (form components type-check in the web app context).
    Check that `libs/ui/src/components/form.tsx` exists and exports FormField, FormItem, etc.
    Check that `libs/ui/src/components/checkbox.tsx` exists and exports Checkbox.
  </verify>
  <done>
    Form (with FormField, FormItem, FormLabel, FormControl, FormMessage) and Checkbox components exist in libs/ui, are re-exported from index.ts, and type-check successfully.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add shadcn/ui DropdownMenu and Avatar components via CLI</name>
  <files>
    libs/ui/src/components/dropdown-menu.tsx
    libs/ui/src/components/avatar.tsx
    libs/ui/package.json
    libs/ui/src/index.ts
  </files>
  <action>
**Step 1: Add DropdownMenu component:**
```bash
cd /workspace/libs/ui && PATH="/tmp/bin:$PATH" pnpm dlx shadcn@latest add dropdown-menu --yes --overwrite
```

**Step 2: Add Avatar component:**
```bash
cd /workspace/libs/ui && PATH="/tmp/bin:$PATH" pnpm dlx shadcn@latest add avatar --yes --overwrite
```

**Step 3: Update libs/ui/src/index.ts to re-export all new components:**
Add re-exports for DropdownMenu and Avatar components:
```typescript
export {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuGroup,
  DropdownMenuItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from './components/dropdown-menu';
export { Avatar, AvatarFallback, AvatarImage } from './components/avatar';
```

**Step 4: Run pnpm install to update lockfile.**
```bash
cd /workspace && pnpm install
```

**Step 5: Verify all components compile:**
```bash
npx nx typecheck web
```

If any import resolution issues arise (e.g., the CLI generates imports like `@/components/...` instead of `@workspace/ui/...`), fix them to match the existing pattern in button.tsx and card.tsx.
  </action>
  <verify>
    `npx nx typecheck web` passes.
    Check that `libs/ui/src/components/dropdown-menu.tsx` exports DropdownMenu and related components.
    Check that `libs/ui/src/components/avatar.tsx` exports Avatar, AvatarFallback, AvatarImage.
    All exports are listed in libs/ui/src/index.ts.
  </verify>
  <done>
    DropdownMenu (with Content, Item, Label, Separator, Trigger) and Avatar (with Fallback, Image) exist in libs/ui, are re-exported from index.ts, and type-check successfully. All 4 new components (Form, Checkbox, DropdownMenu, Avatar) available from @workspace/ui.
  </done>
</task>

</tasks>

<verification>
- `npx nx typecheck web` passes
- All 4 component files exist in libs/ui/src/components/
- libs/ui/src/index.ts re-exports all new components
- `pnpm install` completed without errors
</verification>

<success_criteria>
1. Form, Checkbox, DropdownMenu, Avatar components added via shadcn CLI
2. All components re-exported from @workspace/ui
3. No type errors introduced
4. Package dependencies properly resolved
</success_criteria>

<output>
After completion, create `.planning/phases/13-login-ui/13-02-SUMMARY.md`
</output>
