---
phase: 12-frontend-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - pnpm-workspace.yaml
  - .npmrc
  - .github/workflows/ci.yml
autonomous: false

must_haves:
  truths:
    - "pnpm install succeeds and pnpm-lock.yaml exists"
    - "package-lock.json is deleted"
    - "All existing Nx targets still work (npx nx test api, npx nx test domain)"
    - "GitHub Actions CI workflow uses pnpm (not npm)"
  artifacts:
    - path: "pnpm-workspace.yaml"
      provides: "pnpm workspace configuration for monorepo"
      contains: "apps/*"
    - path: ".npmrc"
      provides: "pnpm configuration"
      contains: "shamefully-hoist"
    - path: ".github/workflows/ci.yml"
      provides: "CI workflow updated for pnpm"
      contains: "pnpm"
  key_links:
    - from: "pnpm-workspace.yaml"
      to: "apps/web/package.json"
      via: "workspace glob"
      pattern: "apps/*"
    - from: ".github/workflows/ci.yml"
      to: "pnpm-lock.yaml"
      via: "pnpm install --frozen-lockfile"
      pattern: "frozen-lockfile"
---

<objective>
Migrate from npm to pnpm as the package manager and update GitHub Actions CI to use pnpm.

Purpose: Switch to pnpm for better monorepo support and stricter dependency resolution before adding frontend dependencies.
Output: Working pnpm workspace with lock file converted, CI updated, all existing tests passing.

IMPORTANT: This plan is NOT autonomous. After execution, the user will create a PR to verify GitHub Actions CI works with pnpm before proceeding.
</objective>

<execution_context>
@/home/developer/.claude/get-shit-done/workflows/execute-plan.md
@/home/developer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-frontend-infrastructure/12-CONTEXT.md
@.planning/phases/12-frontend-infrastructure/12-RESEARCH.md
@package.json
@nx.json
@.github/workflows/ci.yml
</context>

<tasks>

<task type="checkpoint">
  <name>Task 1: Migrate from npm to pnpm</name>
  <files>
    package.json
    pnpm-workspace.yaml
    .npmrc
    .github/workflows/ci.yml
  </files>
  <action>
    1. Install pnpm globally if not available: `npm install -g pnpm`
    2. Create `pnpm-workspace.yaml` at workspace root:
       ```yaml
       packages:
         - 'apps/*'
         - 'libs/*'
       ```
    3. Run `pnpm import` to convert package-lock.json to pnpm-lock.yaml
    4. Delete package-lock.json: `rm package-lock.json`
    5. Create `.npmrc` with `shamefully-hoist=true` (needed for some packages that assume hoisting)
    6. Run `pnpm install` to verify everything works
    7. Update `.github/workflows/ci.yml`:
       - Add pnpm setup step using pnpm/action-setup@v4 (before Node.js setup)
       - Change `cache: "npm"` to `cache: "pnpm"` in actions/setup-node
       - Change `npm ci` to `pnpm install --frozen-lockfile` in both jobs
    8. Verify existing Python Nx targets still work:
       - `npx nx test domain` (quick sanity check — domain has no npm deps)
       - `npx nx test api` (verify full backend still works)
       - `npx nx run-many -t lint typecheck` (verify all quality gates)

    IMPORTANT: The root package.json has devDependencies for mjml and nx. Keep these. Do NOT add a "name" field with @ scope to root package.json — it's the workspace root.
  </action>
  <verify>
    - `pnpm install` succeeds without errors
    - `pnpm-lock.yaml` exists
    - `package-lock.json` does not exist
    - `npx nx test domain` passes
    - `npx nx test api` passes
    - `npx nx run-many -t lint typecheck` passes
    - `npx nx show projects` lists all 4 projects (api, domain, web, ui)
  </verify>
  <checkpoint>
    After verifying locally, the user will:
    1. Create a branch and PR with the pnpm migration
    2. Verify GitHub Actions CI passes with pnpm
    3. Merge the PR before proceeding to plan 12-02

    This checkpoint ensures CI works with pnpm before layering React/Vite/Tailwind on top.
  </checkpoint>
  <done>pnpm is the package manager. Lock file converted. CI updated. All existing Nx targets verified. Ready for user to PR and verify CI.</done>
</task>

</tasks>

<verification>
1. `pnpm install` succeeds (no package-lock.json, pnpm-lock.yaml exists)
2. `npx nx show projects` lists api, domain, web, ui
3. `npx nx test domain` passes (Python targets unaffected)
4. `npx nx test api` passes (full backend unaffected)
5. `npx nx run-many -t lint typecheck` passes (all quality gates)
6. `.github/workflows/ci.yml` uses pnpm/action-setup@v4 and pnpm install --frozen-lockfile
</verification>

<success_criteria>
- pnpm is the package manager with workspace config
- Lock file converted from npm to pnpm
- CI workflow updated for pnpm
- All existing Python tests still pass
- All quality gates still pass
- User has verified CI via PR before proceeding
</success_criteria>

<output>
After completion, create `.planning/phases/12-frontend-infrastructure/12-01-SUMMARY.md`
</output>
