---
phase: 12-frontend-infrastructure
plan: 02
type: execute
wave: 2
depends_on: ["12-01"]
files_modified:
  - apps/web/package.json
  - apps/web/project.json
  - apps/web/tsconfig.json
  - apps/web/vite.config.ts
  - apps/web/index.html
  - apps/web/src/main.tsx
  - apps/web/src/app/app.tsx
  - apps/web/src/vite-env.d.ts
  - tsconfig.base.json
  - apps/api/src/adapters/api/app.py
autonomous: true

must_haves:
  truths:
    - "apps/web renders a React app via npx nx serve web on port 5173"
    - "FastAPI CORS allows requests from http://localhost:5173"
    - "TypeScript strict mode enabled with bundler module resolution"
  artifacts:
    - path: "tsconfig.base.json"
      provides: "Root TypeScript config with path aliases"
      contains: "@workspace/ui"
    - path: "apps/web/vite.config.ts"
      provides: "Vite configuration for React app"
      contains: "react()"
    - path: "apps/web/src/main.tsx"
      provides: "React entry point"
      contains: "createRoot"
    - path: "apps/web/index.html"
      provides: "HTML entry point"
      contains: "main.tsx"
  key_links:
    - from: "apps/web/index.html"
      to: "apps/web/src/main.tsx"
      via: "script tag"
      pattern: "src/main.tsx"
    - from: "apps/web/src/main.tsx"
      to: "apps/web/src/app/app.tsx"
      via: "import"
      pattern: "import.*App"
    - from: "apps/web/vite.config.ts"
      to: "tsconfig.base.json"
      via: "nxViteTsPaths plugin"
      pattern: "nxViteTsPaths"
---

<objective>
Scaffold the React+Vite application in apps/web/, set up root TypeScript configuration with path aliases, and update FastAPI CORS for the frontend dev server.

Purpose: Establish the React application foundation that all subsequent plans build upon.
Output: Working React app that renders on port 5173, root tsconfig.base.json with path aliases, and backend CORS configured for the frontend.
</objective>

<execution_context>
@/home/developer/.claude/get-shit-done/workflows/execute-plan.md
@/home/developer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-frontend-infrastructure/12-CONTEXT.md
@.planning/phases/12-frontend-infrastructure/12-RESEARCH.md
@.planning/phases/12-frontend-infrastructure/12-01-SUMMARY.md
@apps/web/package.json
@apps/web/project.json
@libs/ui/package.json
@libs/ui/project.json
@package.json
@nx.json
@apps/api/src/adapters/api/app.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold React+Vite app in apps/web/</name>
  <files>
    apps/web/package.json
    apps/web/project.json
    apps/web/tsconfig.json
    apps/web/vite.config.ts
    apps/web/index.html
    apps/web/src/main.tsx
    apps/web/src/app/app.tsx
    apps/web/src/vite-env.d.ts
    tsconfig.base.json
  </files>
  <action>
    1. Create `tsconfig.base.json` at workspace root with path aliases:
       ```json
       {
         "compilerOptions": {
           "target": "ES2022",
           "module": "ESNext",
           "moduleResolution": "bundler",
           "lib": ["ES2022", "DOM", "DOM.Iterable"],
           "jsx": "react-jsx",
           "strict": true,
           "esModuleInterop": true,
           "skipLibCheck": true,
           "forceConsistentCasingInFileNames": true,
           "resolveJsonModule": true,
           "isolatedModules": true,
           "noEmit": true,
           "declaration": true,
           "declarationMap": true,
           "baseUrl": ".",
           "paths": {
             "@workspace/ui": ["libs/ui/src/index.ts"],
             "@workspace/ui/*": ["libs/ui/src/*"],
             "@/*": ["apps/web/src/*"]
           }
         }
       }
       ```
    2. Install React, Vite, and Nx Vite plugin:
       ```bash
       cd /workspace && pnpm add -D @nx/vite @vitejs/plugin-react
       cd /workspace/apps/web && pnpm add react react-dom && pnpm add -D @types/react @types/react-dom typescript
       ```
    3. Create `apps/web/tsconfig.json` extending base:
       ```json
       {
         "extends": "../../tsconfig.base.json",
         "compilerOptions": {
           "outDir": "../../dist/out-tsc",
           "types": ["vite/client"]
         },
         "include": ["src/**/*.ts", "src/**/*.tsx", "src/**/*.d.ts"],
         "exclude": ["node_modules", "dist"]
       }
       ```
    4. Create `apps/web/vite.config.ts`:
       ```typescript
       import { defineConfig } from 'vite';
       import react from '@vitejs/plugin-react';
       import { nxViteTsPaths } from '@nx/vite/plugins/nx-tsconfig-paths.plugin';

       export default defineConfig({
         root: __dirname,
         cacheDir: '../../node_modules/.vite/apps/web',
         plugins: [react(), nxViteTsPaths()],
         server: {
           port: 5173,
           host: 'localhost',
         },
         preview: {
           port: 4300,
           host: 'localhost',
         },
         build: {
           outDir: '../../dist/apps/web',
           reportCompressedSize: true,
           commonjsOptions: {
             transformMixedEsModules: true,
           },
         },
         test: {
           globals: true,
           environment: 'jsdom',
           setupFiles: './src/test-setup.ts',
           include: ['src/**/*.{test,spec}.{ts,tsx}'],
           reporters: ['default'],
           coverage: {
             reportsDirectory: '../../coverage/apps/web',
             provider: 'v8',
           },
         },
       });
       ```
    5. Create `apps/web/index.html`:
       ```html
       <!DOCTYPE html>
       <html lang="en">
         <head>
           <meta charset="UTF-8" />
           <meta name="viewport" content="width=device-width, initial-scale=1.0" />
           <title>Personal Finance</title>
         </head>
         <body>
           <div id="root"></div>
           <script type="module" src="/src/main.tsx"></script>
         </body>
       </html>
       ```
    6. Create `apps/web/src/main.tsx`:
       ```typescript
       import { StrictMode } from 'react';
       import { createRoot } from 'react-dom/client';
       import { App } from './app/app';

       const root = document.getElementById('root');
       if (!root) throw new Error('Root element not found');

       createRoot(root).render(
         <StrictMode>
           <App />
         </StrictMode>
       );
       ```
    7. Create `apps/web/src/app/app.tsx`:
       ```typescript
       export function App() {
         return (
           <div>
             <h1>Personal Finance</h1>
             <p>App is running.</p>
           </div>
         );
       }
       ```
    8. Create `apps/web/src/vite-env.d.ts`:
       ```typescript
       /// <reference types="vite/client" />
       ```
    9. Update `apps/web/project.json` â€” keep targets empty, @nx/vite plugin infers build/serve/preview/test:
       ```json
       {
         "name": "web",
         "projectType": "application",
         "sourceRoot": "apps/web/src",
         "implicitDependencies": ["ui"],
         "targets": {}
       }
       ```
    10. Update `apps/web/package.json` with pnpm workspace name:
       ```json
       {
         "name": "@workspace/web",
         "version": "0.0.0",
         "private": true
       }
       ```
    11. Verify: `npx nx serve web` starts dev server on port 5173

    IMPORTANT: Check if @nx/vite is available. If Nx inferred targets don't appear, register the plugin in nx.json plugins array. Run `npx nx show project web` to verify inferred targets.
  </action>
  <verify>
    - `npx nx show project web` shows inferred targets (serve, build, test, preview)
    - `npx nx serve web` starts Vite dev server on port 5173
    - Visiting http://localhost:5173 shows "Personal Finance" heading
    - TypeScript compiles without errors: `npx tsc --noEmit -p apps/web/tsconfig.json`
  </verify>
  <done>React+Vite app scaffolded with TypeScript strict mode. Dev server runs on port 5173. Root tsconfig.base.json has path aliases for @workspace/ui and @/.</done>
</task>

<task type="auto">
  <name>Task 2: Update FastAPI CORS for Vite dev server</name>
  <files>
    apps/api/src/adapters/api/app.py
  </files>
  <action>
    In `apps/api/src/adapters/api/app.py`, update the CORS middleware `allow_origins` from `["http://localhost:3000"]` to include the Vite dev server port:
    ```python
    app.add_middleware(
        CORSMiddleware,
        allow_origins=[
            "http://localhost:5173",  # Vite dev server
            "http://localhost:3000",  # Legacy/alternative
        ],
        allow_credentials=True,
        allow_methods=["*"],
        allow_headers=["*"],
    )
    ```
    Also update the comment from "React dev server" to "Vite dev server".

    Run typecheck and test to verify no regressions:
    - `npx nx typecheck api`
    - `npx nx test api` (if quick enough; at minimum typecheck)
  </action>
  <verify>
    - `npx nx typecheck api` passes
    - CORS middleware includes http://localhost:5173 in allow_origins
  </verify>
  <done>FastAPI backend allows CORS from Vite dev server on port 5173.</done>
</task>

</tasks>

<verification>
1. `npx nx show project web` shows inferred targets
2. `npx nx serve web` starts React app on port 5173
3. `npx nx typecheck api` passes (CORS update clean)
4. tsconfig.base.json exists with @workspace/ui and @/ path aliases
5. TypeScript strict mode enabled
</verification>

<success_criteria>
- React+Vite app renders on port 5173
- TypeScript strict mode enabled
- Path aliases configured for cross-project imports
- FastAPI CORS updated for Vite dev server
</success_criteria>

<output>
After completion, create `.planning/phases/12-frontend-infrastructure/12-02-SUMMARY.md`
</output>
