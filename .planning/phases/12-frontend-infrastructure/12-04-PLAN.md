---
phase: 12-frontend-infrastructure
plan: 04
type: execute
wave: 4
depends_on: ["12-03"]
files_modified:
  - libs/ui/package.json
  - libs/ui/project.json
  - libs/ui/tsconfig.json
  - libs/ui/src/index.ts
  - libs/ui/src/lib/utils.ts
  - libs/ui/src/components/button.tsx
  - libs/ui/src/components/card.tsx
  - libs/ui/src/components/input.tsx
  - libs/ui/src/components/label.tsx
  - libs/ui/components.json
  - apps/web/src/app/app.tsx
autonomous: true

must_haves:
  truths:
    - "shadcn/ui Button, Card, Input, Label components render correctly in the browser"
    - "Components import from @workspace/ui path alias (not relative paths)"
    - "libs/ui has no build step -- Vite transpiles source directly"
    - "App shell demonstrates sidebar layout placeholder with shadcn components"
  artifacts:
    - path: "libs/ui/src/lib/utils.ts"
      provides: "cn() utility for merging Tailwind classes"
      contains: "clsx"
    - path: "libs/ui/src/components/button.tsx"
      provides: "shadcn/ui Button component"
      contains: "buttonVariants"
    - path: "libs/ui/src/components/card.tsx"
      provides: "shadcn/ui Card component"
      contains: "CardHeader"
    - path: "libs/ui/src/index.ts"
      provides: "Barrel export for all UI components"
      contains: "export"
    - path: "libs/ui/components.json"
      provides: "shadcn/ui CLI configuration for monorepo"
      contains: "@workspace/ui"
  key_links:
    - from: "apps/web/src/app/app.tsx"
      to: "libs/ui/src/components/button.tsx"
      via: "@workspace/ui path alias"
      pattern: "from '@workspace/ui"
    - from: "libs/ui/components.json"
      to: "apps/web/src/styles/globals.css"
      via: "tailwind.css reference"
      pattern: "globals.css"
---

<objective>
Set up libs/ui as an internal package with shadcn/ui components and create an app shell that demonstrates the component library working end-to-end with Tailwind CSS v4 and dark mode.

Purpose: Establish the shared component library pattern (shadcn/ui in libs/ui, consumed by apps/web) and verify the full stack works together.
Output: Working shadcn/ui components (Button, Card, Input, Label) in libs/ui, importable via @workspace/ui, rendered in an app shell with sidebar layout placeholder.
</objective>

<execution_context>
@/home/developer/.claude/get-shit-done/workflows/execute-plan.md
@/home/developer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-frontend-infrastructure/12-CONTEXT.md
@.planning/phases/12-frontend-infrastructure/12-RESEARCH.md
@.planning/phases/12-frontend-infrastructure/12-01-SUMMARY.md
@.planning/phases/12-frontend-infrastructure/12-02-SUMMARY.md
@.planning/phases/12-frontend-infrastructure/12-03-SUMMARY.md
@apps/web/src/styles/globals.css
@apps/web/vite.config.ts
@tsconfig.base.json
@libs/ui/package.json
@libs/ui/project.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Set up libs/ui as internal package with shadcn/ui components</name>
  <files>
    libs/ui/package.json
    libs/ui/project.json
    libs/ui/tsconfig.json
    libs/ui/src/index.ts
    libs/ui/src/lib/utils.ts
    libs/ui/src/components/button.tsx
    libs/ui/src/components/card.tsx
    libs/ui/src/components/input.tsx
    libs/ui/src/components/label.tsx
    libs/ui/components.json
  </files>
  <action>
    1. Update `libs/ui/package.json` to internal package pattern (no build step):
       ```json
       {
         "name": "@workspace/ui",
         "version": "0.0.0",
         "private": true,
         "main": "./src/index.ts",
         "types": "./src/index.ts",
         "exports": {
           ".": "./src/index.ts",
           "./components/*": "./src/components/*.tsx",
           "./hooks/*": "./src/hooks/*.ts",
           "./lib/*": "./src/lib/*.ts"
         },
         "peerDependencies": {
           "react": "^19.0.0",
           "react-dom": "^19.0.0"
         }
       }
       ```
    2. Create `libs/ui/tsconfig.json`:
       ```json
       {
         "extends": "../../tsconfig.base.json",
         "compilerOptions": {
           "outDir": "../../dist/out-tsc"
         },
         "include": ["src/**/*.ts", "src/**/*.tsx"],
         "exclude": ["node_modules", "dist"]
       }
       ```
    3. Create `libs/ui/components.json` for shadcn/ui CLI monorepo support. This MUST be created before running `shadcn init` or `shadcn add`:
       ```json
       {
         "$schema": "https://ui.shadcn.com/schema.json",
         "style": "new-york",
         "rsc": false,
         "tsx": true,
         "tailwind": {
           "config": "",
           "css": "../../apps/web/src/styles/globals.css",
           "baseColor": "slate",
           "cssVariables": true,
           "prefix": ""
         },
         "aliases": {
           "components": "@workspace/ui/components",
           "utils": "@workspace/ui/lib/utils",
           "ui": "@workspace/ui/components",
           "lib": "@workspace/ui/lib",
           "hooks": "@workspace/ui/hooks"
         }
       }
       ```

    4. Initialize shadcn/ui in the libs/ui directory. Run from `libs/ui/`:
       ```bash
       cd /workspace/libs/ui && npx shadcn@latest init --yes
       ```
       This creates `src/lib/utils.ts` (cn helper) and installs base dependencies (clsx, tailwind-merge, class-variance-authority).
       If the CLI prompts for config, point it to the existing `components.json`.

    5. Install the starter component set via CLI. Run from `libs/ui/`:
       ```bash
       cd /workspace/libs/ui && npx shadcn@latest add button card input label --yes
       ```
       The CLI reads `components.json` aliases and installs components to `libs/ui/src/components/`.
       It also auto-installs any Radix dependencies the components need.

       **Why CLI, not manual:** The CLI gives the latest component source, handles dependencies automatically, and validates that `components.json` is configured correctly. If the monorepo aliases are wrong, the CLI will fail — better to catch that now than later.

       **If the CLI doesn't respect monorepo paths:** Fall back to manual creation using the component source from https://ui.shadcn.com/docs/components. But try the CLI first — monorepo support is an official feature.

    6. Create `libs/ui/src/index.ts` barrel export (the CLI doesn't create this):
       ```typescript
       // Components — re-export what shadcn CLI installed
       export { Button, buttonVariants } from './components/button';
       export type { ButtonProps } from './components/button';
       export {
         Card,
         CardHeader,
         CardFooter,
         CardTitle,
         CardDescription,
         CardContent,
       } from './components/card';
       export { Input } from './components/input';
       export { Label } from './components/label';

       // Utilities
       export { cn } from './lib/utils';
       ```
       Note: Adjust exports if the CLI generates slightly different export names. Read the generated files first.

    7. Update `libs/ui/project.json`:
       ```json
       {
         "name": "ui",
         "projectType": "library",
         "sourceRoot": "libs/ui/src",
         "targets": {}
       }
       ```
       No targets needed — libs/ui is source-only, consumed by apps/web's Vite build.

    8. Verify the import path works: Import from @workspace/ui in apps/web to confirm resolution.

    IMPORTANT: The key to making this work is:
    - tsconfig.base.json has path alias "@workspace/ui" -> "libs/ui/src/index.ts"
    - nxViteTsPaths() plugin in vite.config.ts resolves these paths for Vite
    - libs/ui package.json main/types point to raw .ts source
    - Dependencies installed by shadcn CLI (clsx, tailwind-merge, cva, radix) must be resolvable from apps/web where Vite runs. If pnpm hoisting doesn't cover this, install them in apps/web too.
  </action>
  <verify>
    - `npx tsc --noEmit -p apps/web/tsconfig.json` passes (imports from @workspace/ui resolve)
    - `npx tsc --noEmit -p libs/ui/tsconfig.json` passes (component types valid)
    - libs/ui has no dist/ directory (no build step)
    - components.json exists with correct monorepo aliases
  </verify>
  <done>libs/ui configured as internal package with shadcn/ui Button, Card, Input, Label components. cn() utility available. components.json ready for future CLI additions.</done>
</task>

<task type="auto">
  <name>Task 2: Create app shell with sidebar layout and shadcn component demo</name>
  <files>
    apps/web/src/app/app.tsx
  </files>
  <action>
    1. Update `apps/web/src/app/app.tsx` to use shadcn/ui components from @workspace/ui and demonstrate the sidebar layout pattern:
       ```typescript
       import { useEffect, useState } from 'react';
       import {
         Button,
         Card,
         CardHeader,
         CardTitle,
         CardContent,
         Input,
         Label,
       } from '@workspace/ui';

       export function App() {
         const [isDark, setIsDark] = useState(false);

         useEffect(() => {
           const stored = localStorage.getItem('theme');
           if (stored === 'dark' || (!stored && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
             setIsDark(true);
             document.documentElement.classList.add('dark');
           }
         }, []);

         const toggleTheme = () => {
           const next = !isDark;
           setIsDark(next);
           document.documentElement.classList.toggle('dark', next);
           localStorage.setItem('theme', next ? 'dark' : 'light');
         };

         return (
           <div className="flex min-h-screen bg-background text-foreground">
             {/* Left Sidebar - persistent, like Quicken/YNAB */}
             <aside className="w-[var(--sidebar-width)] border-r border-border bg-card p-4 flex flex-col gap-4">
               <h2 className="text-lg font-semibold text-primary">Accounts</h2>
               <nav className="space-y-1">
                 <div className="px-3 py-2 rounded-md bg-accent text-accent-foreground text-sm font-medium">
                   Checking
                 </div>
                 <div className="px-3 py-2 rounded-md text-muted-foreground text-sm hover:bg-accent hover:text-accent-foreground transition-colors cursor-pointer">
                   Savings
                 </div>
                 <div className="px-3 py-2 rounded-md text-muted-foreground text-sm hover:bg-accent hover:text-accent-foreground transition-colors cursor-pointer">
                   Credit Card
                 </div>
               </nav>
               <div className="mt-auto">
                 <Button variant="ghost" size="sm" onClick={toggleTheme} className="w-full justify-start">
                   {isDark ? 'Light' : 'Dark'} Mode
                 </Button>
               </div>
             </aside>

             {/* Main Content */}
             <main className="flex-1 p-6 space-y-6">
               <h1 className="text-2xl font-bold">Personal Finance</h1>

               <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
                 <Card>
                   <CardHeader>
                     <CardTitle>Checking</CardTitle>
                   </CardHeader>
                   <CardContent>
                     <p className="text-2xl font-bold font-mono">$1,234.56</p>
                   </CardContent>
                 </Card>
                 <Card>
                   <CardHeader>
                     <CardTitle>Savings</CardTitle>
                   </CardHeader>
                   <CardContent>
                     <p className="text-2xl font-bold font-mono">$15,678.90</p>
                   </CardContent>
                 </Card>
                 <Card>
                   <CardHeader>
                     <CardTitle>Credit Card</CardTitle>
                   </CardHeader>
                   <CardContent>
                     <p className="text-2xl font-bold font-mono amount-negative">-$542.30</p>
                   </CardContent>
                 </Card>
               </div>

               <Card>
                 <CardHeader>
                   <CardTitle>Quick Add Transaction</CardTitle>
                 </CardHeader>
                 <CardContent className="space-y-4">
                   <div className="grid gap-2">
                     <Label htmlFor="payee">Payee</Label>
                     <Input id="payee" placeholder="Enter payee name" />
                   </div>
                   <div className="grid gap-2">
                     <Label htmlFor="amount">Amount</Label>
                     <Input id="amount" type="number" placeholder="0.00" className="font-mono" />
                   </div>
                   <Button>Add Transaction</Button>
                 </CardContent>
               </Card>
             </main>
           </div>
         );
       }
       ```
    2. Verify: `npx nx serve web` -- page shows sidebar layout with shadcn/ui components rendering correctly
    3. Verify dark mode: Click the toggle button in the sidebar -- all components switch theme
    4. Verify fonts: Balance amounts use JetBrains Mono (monospace), nav text uses Inter

    This app shell demonstrates:
    - Left sidebar navigation pattern (Quicken/YNAB style, per user decision)
    - shadcn/ui components from @workspace/ui (Button, Card, Input, Label)
    - Dark mode with theme toggle
    - Inter for UI text, JetBrains Mono for financial figures
    - Negative amounts in red (per user decision)
    - Responsive grid for account cards
    - CSS variables for all theme colors

    This is a DEMO shell -- not the real app. Phase 13+ will replace this with actual routing and features.
  </action>
  <verify>
    - `npx nx serve web` renders app shell with sidebar and shadcn components
    - Button, Card, Input, Label render with proper styling
    - Dark mode toggle works (sidebar, cards, inputs all switch)
    - Imports use @workspace/ui (not relative paths to libs/ui)
    - No TypeScript errors: `npx tsc --noEmit -p apps/web/tsconfig.json`
    - **Visual (Chrome):** Use Claude Code Chrome to open http://localhost:5173 and take a screenshot. Confirm: (1) left sidebar with "Accounts" navigation is visible, (2) account cards render with styled headings and monospace balances, (3) "Quick Add Transaction" form shows Input and Label components, (4) Button renders with shadcn styling. Then click dark mode toggle and screenshot to confirm all components switch theme.
  </verify>
  <done>App shell with left sidebar layout, shadcn/ui components, dark mode toggle, and font demonstration. Full @workspace/ui -> apps/web integration verified.</done>
</task>

</tasks>

<verification>
1. `npx nx serve web` renders app with sidebar layout and shadcn/ui components
2. All 4 shadcn/ui components work: Button (with variants), Card (with sections), Input, Label
3. Imports resolve via @workspace/ui path alias
4. Dark mode toggle switches all components
5. TypeScript compiles: `npx tsc --noEmit -p apps/web/tsconfig.json`
6. libs/ui has no dist/ directory (source-only internal package)
7. **Visual (Chrome):** Screenshot confirms sidebar layout, shadcn component styling, and dark mode toggle all working end-to-end
</verification>

<success_criteria>
- libs/ui is an internal package with no build step
- shadcn/ui Button, Card, Input, Label installed and rendering
- cn() utility available for class merging
- components.json configured for future shadcn/ui CLI additions
- App shell demonstrates sidebar layout with all components
- @workspace/ui import path works end-to-end
</success_criteria>

<output>
After completion, create `.planning/phases/12-frontend-infrastructure/12-04-SUMMARY.md`
</output>
