---
phase: 12-frontend-infrastructure
plan: 06
type: execute
wave: 1
depends_on: []
files_modified:
  - libs/ui/src/components/button.tsx
  - libs/ui/src/components/card.tsx
  - libs/ui/src/components/input.tsx
  - libs/ui/src/components/label.tsx
  - libs/ui/src/index.ts
  - apps/web/playwright.config.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "shadcn/ui components installed via official CLI (not manually created)"
    - "All existing component exports remain intact (Button, buttonVariants, Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent, Input, Label)"
    - "App renders without errors after component replacement"
    - "All quality gates pass (lint, typecheck, test)"
    - "Playwright uses system Chromium (/usr/bin/chromium) instead of downloading its own bundled copy"
    - "Playwright e2e tests pass against running dev server"
  artifacts:
    - path: "libs/ui/src/components/button.tsx"
      provides: "CLI-generated Button component"
    - path: "libs/ui/src/components/card.tsx"
      provides: "CLI-generated Card component"
    - path: "libs/ui/src/components/input.tsx"
      provides: "CLI-generated Input component"
    - path: "libs/ui/src/components/label.tsx"
      provides: "CLI-generated Label component"
    - path: "apps/web/playwright.config.ts"
      provides: "Playwright config using system Chromium executable"
  key_links:
    - from: "libs/ui/src/index.ts"
      to: "libs/ui/src/components/*.tsx"
      via: "re-exports"
      pattern: "export.*from.*components/"
    - from: "apps/web/src/app/app.tsx"
      to: "@workspace/ui"
      via: "import"
      pattern: "import.*from '@workspace/ui'"
---

<objective>
Replace manually-created shadcn/ui components with official CLI-generated versions.

Purpose: During Phase 12-04, ui.shadcn.com was unreachable (firewall), so components were manually created by copying from documentation. The site is now reachable (HTTP 200 confirmed). Running the CLI ensures components match the official registry exactly, including any subtle differences in class names, accessibility attributes, or Radix primitive usage that manual copying may have missed.

Additionally, fix Playwright to use the system Chromium (`/usr/bin/chromium`) already installed in the devcontainer Dockerfile, instead of downloading its own bundled copy (~180 MB). The Playwright browser cache was lost on container rebuild, confirming this is the wrong approach. Verify e2e tests pass with the system browser.

Output: Four CLI-generated component files (button, card, input, label) that replace the manual versions, with all existing exports and imports preserved. Playwright configured to use system Chromium with passing e2e tests.
</objective>

<execution_context>
@/home/developer/.claude/get-shit-done/workflows/execute-plan.md
@/home/developer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@libs/ui/components.json
@libs/ui/package.json
@libs/ui/src/index.ts
@apps/web/src/app/app.tsx
@apps/web/playwright.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace components with CLI-generated versions</name>
  <files>
    libs/ui/src/components/button.tsx
    libs/ui/src/components/card.tsx
    libs/ui/src/components/input.tsx
    libs/ui/src/components/label.tsx
  </files>
  <action>
    Run the shadcn CLI from libs/ui/ to overwrite all four components with official versions:

    ```bash
    cd libs/ui && npx shadcn@latest add button card input label --overwrite --yes
    ```

    The CLI will use components.json (already configured for monorepo with new-york style) to generate components into src/components/.

    After CLI runs, verify:
    1. Each file exists and has content (not empty)
    2. Each file imports `cn` from `../lib/utils` (the monorepo path)
    3. Button exports both `Button` and `buttonVariants`
    4. Card exports `Card`, `CardHeader`, `CardFooter`, `CardTitle`, `CardDescription`, `CardContent`
    5. Input exports `Input`
    6. Label exports `Label`

    If the CLI changes any export names or removes exports that apps/web/src/app/app.tsx depends on, manually fix the exports to maintain backward compatibility. The app imports: `Button, Card, CardHeader, CardTitle, CardContent, Input, Label` from `@workspace/ui`.

    Also check libs/ui/src/index.ts still re-exports everything correctly. If the CLI modified it or if new exports appeared, update index.ts to include them.

    Run `pnpm install` if the CLI added any new dependencies to libs/ui/package.json.
  </action>
  <verify>
    ```bash
    # Verify files exist and have content
    wc -l libs/ui/src/components/button.tsx libs/ui/src/components/card.tsx libs/ui/src/components/input.tsx libs/ui/src/components/label.tsx

    # Verify exports match what app.tsx imports
    grep -c "export.*Button" libs/ui/src/components/button.tsx
    grep -c "export.*Card" libs/ui/src/components/card.tsx
    grep -c "export.*Input" libs/ui/src/components/input.tsx
    grep -c "export.*Label" libs/ui/src/components/label.tsx

    # Verify index.ts re-exports all components
    grep "Button" libs/ui/src/index.ts
    grep "Card" libs/ui/src/index.ts
    grep "Input" libs/ui/src/index.ts
    grep "Label" libs/ui/src/index.ts
    ```
  </verify>
  <done>All four component files replaced by official shadcn CLI output. All exports preserved. index.ts re-exports intact.</done>
</task>

<task type="auto">
  <name>Task 2: Verify all quality gates and tests pass</name>
  <files>
    libs/ui/src/components/button.tsx
    libs/ui/src/components/card.tsx
    libs/ui/src/components/input.tsx
    libs/ui/src/components/label.tsx
  </files>
  <action>
    Run the full verification ladder for the web project to confirm the CLI-generated components work identically to the manual versions:

    1. TypeScript compilation: `npx nx typecheck web`
    2. Lint: `npx nx lint web`
    3. Unit tests: `npx nx test web`
    4. Format check: `npx nx format web`

    If any step fails, diagnose and fix. Common issues:
    - CLI may generate slightly different TypeScript patterns (e.g., `React.ComponentProps` vs `React.ComponentPropsWithoutRef`) -- fix type errors
    - CLI may use different import style -- ensure `cn` import resolves
    - New Radix dependencies may need `pnpm install`

    If lint or format fails on CLI-generated files, run the fixer:
    - `npx nx lint web --fix` for lint issues
    - Format: `cd apps/web && npx prettier --write ../libs/ui/src/components/*.tsx` (or equivalent Nx target)

    Do NOT change the component logic to pass tests -- the CLI output is the source of truth. Only fix formatting/lint issues.
  </action>
  <verify>
    ```bash
    npx nx typecheck web
    npx nx lint web
    npx nx test web
    npx nx format web
    ```
    All four commands exit 0.
  </verify>
  <done>All quality gates pass. CLI-generated shadcn/ui components are fully integrated and working.</done>
</task>

<task type="auto">
  <name>Task 3: Fix Playwright to use system Chromium and verify e2e tests</name>
  <files>
    apps/web/playwright.config.ts
  </files>
  <action>
    The devcontainer Dockerfile installs system Chromium (`apt-get install chromium`), available at `/usr/bin/chromium`. Plan 12-05 incorrectly ran `npx playwright install chromium` which downloaded a separate bundled copy (~180 MB). After container rebuild the Playwright browser cache is gone, so e2e tests would fail.

    Fix: Configure Playwright to use the system Chromium executable.

    1. Update `apps/web/playwright.config.ts` to set `executablePath` on the chromium project:

    ```ts
    projects: [
      {
        name: 'chromium',
        use: {
          ...devices['Desktop Chrome'],
          launchOptions: {
            executablePath: '/usr/bin/chromium',
            args: ['--no-sandbox', '--disable-gpu', '--disable-dev-shm-usage'],
          },
        },
      },
    ],
    ```

    The `--no-sandbox` flag is required because the devcontainer runs as non-root user in a container. `--disable-dev-shm-usage` prevents shared memory issues in Docker.

    2. Verify the system chromium works: `chromium --version` should return a version string.

    3. Start the dev server and run e2e tests:
    - Start: `npx nx serve web` (in background)
    - Wait for server to be ready on port 5173
    - Run: `npx nx e2e web`
    - Both smoke tests should pass (app loads without errors, UI elements render)
    - Stop the dev server

    4. Remove any `postinstall` or `prepare` scripts in apps/web/package.json that run `playwright install` (if any exist). The system browser is sufficient.
  </action>
  <verify>
    ```bash
    # Verify system chromium is available
    /usr/bin/chromium --version

    # Verify no Playwright browsers in cache (we use system one)
    ls ~/.cache/ms-playwright/ 2>/dev/null && echo "WARN: playwright cache exists" || echo "OK: no playwright cache"

    # Verify e2e tests pass (requires dev server running)
    npx nx e2e web
    ```
    All checks pass. e2e tests use system Chromium.
  </verify>
  <done>Playwright configured to use system Chromium at /usr/bin/chromium. E2e smoke tests pass. No redundant browser download needed.</done>
</task>

</tasks>

<verification>
1. `cd libs/ui && npx shadcn@latest diff` reports no updates (components match registry)
2. `npx nx typecheck web` passes with zero errors
3. `npx nx lint web` passes with zero errors
4. `npx nx test web` passes (2 component tests)
5. `npx nx format web` passes
6. All exports in libs/ui/src/index.ts resolve correctly
7. apps/web/src/app/app.tsx imports work without changes
8. Playwright config points to `/usr/bin/chromium` (not Playwright-managed browser)
9. `npx nx e2e web` passes (2 e2e smoke tests) using system Chromium
10. No Playwright browser cache at `~/.cache/ms-playwright/`
</verification>

<success_criteria>
- Components in libs/ui/src/components/ are CLI-generated (not manually created)
- All existing imports in apps/web continue to work
- All quality gates pass (typecheck, lint, test, format)
- `shadcn diff` shows no updates needed
- Playwright uses system Chromium, not a bundled download
- E2e smoke tests pass against running dev server
</success_criteria>

<output>
After completion, create `.planning/phases/12-frontend-infrastructure/12-06-SUMMARY.md`
</output>
